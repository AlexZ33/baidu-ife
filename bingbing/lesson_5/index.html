<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>lesson-5</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="controll">
    <input type="text" id="text">
    <div class="btn_group">
      <button id="left_enter">左侧入</button>
      <button id="right_enter">右侧入</button>
    </div>
    <div class="btn_group">
      <button id="left_leave">左侧出</button>
      <button id="right_leave">右侧出</button>
    </div>
    <div class="btn_group">
      <button id="sort_b_p">冒泡(正)</button>
      <button id="sort_b_r">冒泡(逆)</button>
    </div>
  </div>

  <ul id="show"></ul>

  <ul id="step">
    <li>请打开控制台查看排序步骤</li>
  </ul>

  <script src="utils.js"></script>
  <script src="sort.js"></script>
  <script src="queue.js"></script>
  <script>
  // 启动
  window.onload = function () {
    var
      $step   = $('#step'),
      liQueue = new Queue({
        wrapSelector: '#show',
        maxLength: 60,
        maxLengthCb (maxNum) {
          alert(`已达最大长度${maxNum},不能再添加了！`)
        },
        sortCb (type, a, b) {
          const $li = document.createElement('li')

          $li.innerHTML = type ? `${a} 比 ${b}大，交换位置` : `${a} 比 ${b}小，交换位置`
          $step.appendChild($li)
          console.log($li.innerHTML)
          sleep(800) // 堵塞线程
        }
      }),
      getNum  = getInputValueNum('#text') // 获取输入的数字
    window.li = liQueue
    // 生成初始队列
    liQueue.init([50, 61, 32])

    // 事件函数
    // left enter
    function bindLeftEnterEvent () {
      var num = getNum()
      if (num) liQueue.unshift(num)
    }
    // right enter
    function bindRightEnterEvent () {
      var num = getNum()
      if (num) liQueue.push(num)
    }
    // left leave
    function bindLeftLeaveEvent () {
      if ( ! liQueue.shift())
        alert('没有可删除的元素了')
    }
    // right leave
    function bindRightLeaveEvent () {
      if ( ! liQueue.pop())
        alert('没有可删除的元素了')
    }
    // sort p
    function bindSortPEvent () {
      console.log('冒泡排序(正)开始')
      $step.innerHTML = ''
      liQueue.sort(true)
      console.log('冒泡排序(正)结束')
    }
    // sort r
    function bindSortREvent () {
      console.log('冒泡排序(逆)开始')
      $step.innerHTML = ''
      liQueue.sort(false)
      console.log('冒泡排序(逆)结束')
    }

    function bindLiLeaveEvent (ev) {
      if ( ! ev.target || ! (ev.target.nodeName === 'LI')) return
      liQueue.remove(ev.target.getAttribute('data-index'))
    }

    // 绑定事件
    bindClick('#left_enter',  bindLeftEnterEvent)
    bindClick('#right_enter', bindRightEnterEvent)
    bindClick('#left_leave',  bindLeftLeaveEvent)
    bindClick('#right_leave', bindRightLeaveEvent)
    bindClick('#sort_b_p',    bindSortPEvent)
    bindClick('#sort_b_r',    bindSortREvent)
    bindClick('#show',        bindLiLeaveEvent)
  }
  </script>

</body>
</html>
